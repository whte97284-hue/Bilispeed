解压压缩包（必须解压，不可在压缩包内直接运行）。

确保文件夹内包含 Bili_Final.exe 以及 config.json BBdown.exe ffmpeg.exe（首次运行会生成和压缩包自带）。

双击 Bili_Final.exe，稍等片刻，浏览器将自动弹出控制台界面。

**获取 SESSDATA(必读)**

SESSDATA 是您的 B站“通行证”，不填或填错将无法获取任何数据。

获取步骤（以 Chrome/Edge 浏览器为例）：

在浏览器中打开 Bilibili 并登录账号。

按键盘 F12 键打开“开发者工具”。

在开发者工具顶部菜单栏点击 Application（应用）。

注：如果没看到，点菜单栏右侧的 >> 箭头。

在左侧栏展开 Cookies，点击 https://www.bilibili.com。

在右侧列表中找到 SESSDATA 一栏。

复制 Value（值）下方的那串字符（通常以数字或字母开头，很长）。

回到软件侧边栏，粘贴到 “账号凭证 (SESSDATA)” 输入框中，系统会自动保存。

**功能模块**

视频数据获取：输入目标 UID（支持多行），设置并发数，点击“开始抓取”。结束后可导出包含封面的csv文件，json文件在data文件夹里

封面提取：输入目标 UID，扫描所有视频封面，支持预览、全选及一键批量高清下载。

任务日志：侧边栏实时记录操作状态，方便回溯。

视频监测：可以自定义时间对单个视频实行流量数据监测，包含了哨兵删评监测机制。

视频下载：突破反爬后使用BBdown开源框架进行不限速下载视频、弹幕、音频，支持三种编码，使用ffmpeg开源软件合成视频。

港澳台番剧下载模块使用手册与开发日志
1. 功能概述
本模块旨在解决 Bilibili 港澳台限定番剧（HMT）的下载难题。由于 B 站对区域限定内容的严格风控（包括 IP 检测、SSL 指纹识别、API 鉴权），常规下载方式极易失效。本模块通过集成 BBDown 核心引擎，配合本地凭证注入、接口策略切换及网络代理接管技术，实现了对区域限制资源的解析与下载。

2. 前置条件
在使用本功能前，请确保满足以下硬性条件，缺一不可：

账号权限：必须拥有 Bilibili 年度大会员或普通大会员资格（港澳台番剧通常为会员专享）。

网络环境：必须拥有高质量的台湾或香港原生 IP 代理节点（非机房 IP），并已配置 HTTP 代理端口（如 127.0.0.1:7890）。

核心组件：确保运行目录下包含 BBDown.exe 和 ffmpeg.exe。

3. 操作流程
步骤一：获取本地身份凭证
为了通过 B 站的高级鉴权，不能仅依赖网页 Cookie，建议获取 APP 端凭证。

在脚本侧边栏找到 账号凭证 区域。

点击 扫码登录 (自动获取) 按钮。

等待控制台显示日志，当出现二维码图片或链接时，使用手机 B 站 APP 扫码。

登录成功后，脚本会自动在根目录生成 BBDown.data 文件，并自动刷新页面。

步骤二：配置下载参数
进入 视频下载 -> 直链/番剧下载 标签页，进行如下配置（推荐稳定配置）：

资源链接：输入番剧的 ss ID 或 ep ID。

HTTP 代理地址：必填。格式为 http://IP:端口。

接口模式：推荐选择 Web 接口 (推荐)。此模式模拟浏览器访问，风控阈值最低，通过率最高。

画质/编码：建议均设置为 自动 (Auto)。强制指定编码（如 AVC）可能因源视频缺失该格式导致下载失败。

Aria2 加速：务必关闭。多线程下载极易触发 B 站的防火墙阻断（表现为 SSL 连接错误），单线程下载虽然较慢但最为稳定。

使用扫码凭证：勾选。系统将优先读取本地 BBDown.data 文件。

步骤三：执行下载与验证
点击 开始下载。

观察下方弹出的诊断信息框，确认“身份”为“本地凭证”，“网络”为“代理已启用”。

等待日志滚动。若出现百分比进度条，即表示下载成功。

下载完成后，视频文件将保存在 history/videos/Downloads_Direct 目录下。

4. 常见问题排查 (FAQ)
Q1: 报错 Arg_IndexOutOfRangeException
原因：BBDown 获取到的视频流列表为空。通常是因为 B 站服务器判定当前 IP 不在港澳台地区，或者账号未登录/非会员。 解决方案：

检查账号是否为大会员。

更换代理节点，必须使用原生解锁节点的 IP。

将画质和编码设置为“自动”。

尝试切换“接口模式”为 Web 接口。

Q2: 报错 net_http_ssl_connection_failed
原因：SSL 握手失败。B 站防火墙识别出了非浏览器的 TLS 指纹，或者是 Aria2 多线程并发连接被判定为攻击行为，从而切断连接。 解决方案：

取消勾选 Aria2 加速，使用单线程下载。

更换代理节点。

Q3: 报错 ERROR: {"code":-10403,"message":"购买后才能观看哦"}
原因：鉴权成功，但权限不足。 解决方案：

确认扫码的账号是否具有大会员有效期。

若是大会员依然报错，说明当前接口（通常是 TV 或 Web）的风控策略在该 IP 下生效，请尝试切换接口模式。

Q4: 提示下载成功，但文件夹内没有视频文件
原因：

下载的是番剧，文件被存放在了子文件夹中（如 Downloads_Direct/番剧名/xx.mp4）。

下载过程中被服务端阻断，导致只下载了弹幕文件（XML/ASS），因为弹幕服务器通常不锁区。 解决方案：

检查子目录。

参考 Q2 的解决方案，关闭 Aria2，确保视频流下载完成。

Q5: 界面报错 NotFoundError: ... removeChild
原因：Streamlit 前端渲染性能瓶颈。当后台日志刷新频率过高（如 Aria2 的进度刷新），前端 DOM 节点更新不及导致崩溃。 解决方案：

此错误不影响后台实际下载进程。

最新版本已在代码层面加入了日志限速（0.3秒刷新一次），重启终端即可解决。

5. 开发更新日志
V37.0 (Stable) - 救砖稳健版
变更：重构接口策略，将 Web 接口 设为默认推荐。

修复：强制在 Web 模式下也加载本地凭证 (BBDown.data)，不再依赖单纯的 SESSDATA 字符串。

优化：默认关闭 Aria2 加速选项，以解决高频出现的 SSL 阻断问题。

目的：牺牲部分画质上限和下载速度，换取最高的下载成功率和 IP 存活率。

V36.0 - 强制 APP 接口版 (已废弃)
尝试：强制所有请求走 APP 接口，试图获取最高画质。

问题：APP 接口对 IP 纯净度要求极高，导致大量机房代理节点报错 IndexOutOfRange。

V33.0 - 接口分流策略
功能：引入接口选择器，允许用户在 APP、TV、Web 三种模式间切换。

优化：增加对代理地址格式的自动修复（自动补全 http://）。

V31.0 - 凭证注入修复
修复：解决“扫码成功但下载提示未登录”的问题。

机制：将 Python 脚本的工作目录强制锁定为根目录，确保 subprocess 能正确读取到 BBDown.data 文件。

V30.0系列 - 扫码登录集成
新增：V30.0 引入二维码生成库，实现界面扫码。

优化：V30.3 增加日志清洗功能，过滤控制台字符画乱码。

修复：V30.6 增加文件完整性校验和延迟退出机制，防止生成 0KB 的空凭证文件。

V29.0 - 区域限制突破
里程碑：首次引入 HTTP_PROXY 环境变量注入和 -app 参数，实现了对港澳台资源的基础解析能力。
<img width="3840" height="1947" alt="42a23b25246a222777014d504ed54512" src="https://github.com/user-attachments/assets/7bb9d65f-20ed-42d7-9ef8-d5aeac66613b" />
<img width="3840" height="1944" alt="f1f29f0713ed103ebf270ff4ad7606c6" src="https://github.com/user-attachments/assets/77a43271-896a-4716-95a5-8f7dde1ba7b0" />
<img width="3840" height="1944" alt="bd62cf34bcc10683fc602f2a63655880" src="https://github.com/user-attachments/assets/294d59a2-6d7f-470c-9b62-8436a8d7a96f" />
