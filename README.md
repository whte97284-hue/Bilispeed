# 📺 Bilispeed：B站数据分析与全能下载工具箱

> 集成数据抓取、封面提取、流量监测及 **港澳台番剧(HMT)下载** 于一体的桌面端效率工具。
> 基于 Python、Streamlit 与 BBDown 构建，专为数据囤积者打造。

---

## 🚀 快速开始 (Quick Start)

为确保软件正常运行，请务必严格按照以下步骤操作：

1.  **解压文件**：🛑 **严禁在压缩包内直接运行**！请将压缩包解压至独立的文件夹。
2.  **环境自检**：确认文件夹内包含以下核心文件（首次运行会自动生成或调用）：
    * `Bili_Final.exe` (主程序)
    * `BBdown.exe` (下载引擎)
    * `ffmpeg.exe` (转码引擎)
    * `config.json` (配置文件)
3.  **启动程序**：双击 `Bili_Final.exe`，稍等片刻，系统将自动调用默认浏览器打开可视化控制台。

---

## 🔑 核心配置：获取 SESSDATA (必读)

> ⚠️ **SESSDATA 是您的 B站身份通行证，未填写将无法获取任何数据或下载高清视频。**

**获取步骤（推荐使用 Chrome/Edge）：**
1.  在浏览器访问 Bilibili 并登录您的账号。
2.  按键盘 **`F12`** 打开开发者工具。
3.  点击顶部菜单栏的 **`Application` (应用)**（若未显示，请点击栏目右侧的 `>>` 箭头）。
4.  在左侧栏展开 **`Cookies`** -> 点击 `https://www.bilibili.com`。
5.  在右侧详情页找到 **`SESSDATA`** 一栏。
6.  复制 **`Value` (值)** 下方的那串长字符。
7.  回到软件侧边栏，粘贴至 **“账号凭证 (SESSDATA)”** 输入框，系统将自动保存。

---

## 📦 功能模块概览

| 模块名称 | 功能描述 |
| :--- | :--- |
| **📊 视频数据获取** | 支持多行 UID 批量输入，自定义并发数抓取。支持导出含封面的 CSV 报表及 JSON 源文件（存于 `data` 目录）。 |
| **🖼️ 封面提取** | 一键扫描目标 UID 的所有投稿封面，支持在线预览、全选及**批量下载高清原图**。 |
| **📝 任务日志** | 侧边栏实时记录所有操作状态与报错信息，方便回溯与排查。 |
| **🔴 视频监测** | 针对单个视频进行自定义时长的流量数据监控，内置**哨兵机制**（自动检测评论删除情况）。 |
| **🎥 视频下载** | 集成 **BBDown** 框架，突破反爬限制。支持不限速下载视频/弹幕/音频，支持 AVC/HEVC/AV1 编码，自动调用 FFmpeg 合成。 |

---

## 🌏 港澳台番剧下载 (HMT Module)

**独家功能**：集成网络代理接管与本地凭证注入技术，有效解决 IP 检测、SSL 指纹识别及 API 鉴权问题，实现区域限制番剧下载。

### 1. 前置条件 (缺一不可)
* ✅ **账号权限**：必须拥有 **Bilibili 大会员**（年度/季度/月度均可）。
* ✅ **网络环境**：必须拥有高质量的 **台湾或香港原生 IP 代理节点**（非机房 IP），并配置好 HTTP 代理端口（如 `127.0.0.1:7890`）。
* ✅ **核心组件**：运行目录下必须存在 `BBDown.exe` 和 `ffmpeg.exe`。

### 2. 操作流程

#### 📌 步骤一：获取本地身份凭证 (APP接口鉴权)
1.  在脚本侧边栏找到 **账号凭证** 区域。
2.  点击 **`📱 扫码登录 (自动获取)`** 按钮。
3.  等待控制台弹出二维码或链接，使用 **手机 B 站 APP** 扫码确认。
4.  登录成功后，根目录会自动生成 `BBDown.data` 文件，页面将自动刷新。

#### 📌 步骤二：配置下载参数 (推荐稳健方案)
进入 `视频下载` -> `直链/番剧下载` 标签页，按以下标准配置：

* **资源链接**：输入番剧的 `ssID` 或 `epID`。
* **HTTP 代理地址**：**必填**，格式为 `http://IP:端口`。
* **接口模式**：推荐选择 **`Web 接口 (推荐)`**（模拟浏览器环境，风控阈值最低，通过率最高）。
* **画质/编码**：建议均设置为 **`自动 (Auto)`**（强制指定特定编码可能因源缺失导致下载失败）。
* **Aria2 加速**：**⚠️ 务必关闭**。多线程下载极易触发防火墙 SSL 阻断，单线程虽然较慢但最稳定。
* **使用扫码凭证**：**勾选**（强制程序优先读取本地 `BBDown.data`）。

#### 📌 步骤三：执行下载
点击 **开始下载**。观察诊断框确认“身份”为“本地凭证”，“网络”为“代理已启用”。
等待日志滚动，下载完成后文件将保存至 `history/videos/Downloads_Direct` 目录。

---

## 🛠️ 常见问题排查 (FAQ)

<details>
<summary><strong>Q1: 报错 Arg_IndexOutOfRangeException</strong></summary>

* **原因**：获取到的视频流列表为空。通常因 B 站判定 IP 不在港澳台地区，或账号无会员权限。
* **解法**：
    1.  检查大会员是否过期。
    2.  更换**原生解锁节点**。
    3.  将画质/编码设为“自动”。
    4.  切换为 **Web 接口**。
</details>

<details>
<summary><strong>Q2: 报错 net_http_ssl_connection_failed</strong></summary>

* **原因**：SSL 握手失败。防火墙识别出非浏览器 TLS 指纹，或判定 Aria2 并发为攻击行为。
* **解法**：**取消勾选 Aria2 加速**；尝试更换代理节点。
</details>

<details>
<summary><strong>Q3: 报错 ERROR: {"code":-10403,"message":"购买后才能观看哦"}</strong></summary>

* **原因**：鉴权成功但权限不足。
* **解法**：确认账号会员有效期；如账号正常依然报错，说明当前接口策略（TV/Web）被风控，请尝试切换接口模式。
</details>

<details>
<summary><strong>Q4: 提示下载成功，但文件夹内没有视频文件</strong></summary>

* **原因**：下载过程被服务端阻断，仅下载了不锁区的弹幕文件。
* **解法**：
    1.  检查是否存在子目录。
    2.  参考 Q2，**关闭 Aria2** 后重试。
</details>

<details>
<summary><strong>Q5: 界面报错 NotFoundError: ... removeChild</strong></summary>

* **原因**：后台日志刷新频率过高，导致前端渲染引擎崩溃。
* **解法**：此错误不影响后台实际下载。最新版已加入日志限速逻辑，**重启终端/程序**即可解决。
</details>

---

## 📝 开发更新日志

* **V37.0 (Stable) - 救砖稳健版**
    * 重构接口策略，默认推荐 **Web 接口**。
    * 强制加载本地凭证 (`BBDown.data`)，不再单纯依赖 SESSDATA 字符串。
    * 默认关闭 Aria2 以解决 SSL 阻断，牺牲速度换取最高成功率。
* **V36.0 (已废弃)**
    * 尝试强制 APP 接口，因高纯度 IP 要求导致大量报错，故回退。
* **V33.0**
    * 引入 APP/TV/Web 三种接口切换策略；增加代理地址格式自动修复功能。
* **V31.0**
    * 修复扫码成功但下载提示未登录问题，锁定工作目录路径。
* **V30.0 系列**
    * 集成二维码生成库实现界面扫码；增加日志清洗及 0KB 凭证文件校验。
* **V29.0**
    * 里程碑版本：首次引入 `HTTP_PROXY` 环境变量注入及 `-app` 参数，突破区域限制。
<img width="3840" height="1947" alt="42a23b25246a222777014d504ed54512" src="https://github.com/user-attachments/assets/7bb9d65f-20ed-42d7-9ef8-d5aeac66613b" />
<img width="3840" height="1944" alt="f1f29f0713ed103ebf270ff4ad7606c6" src="https://github.com/user-attachments/assets/77a43271-896a-4716-95a5-8f7dde1ba7b0" />
<img width="3840" height="1944" alt="bd62cf34bcc10683fc602f2a63655880" src="https://github.com/user-attachments/assets/294d59a2-6d7f-470c-9b62-8436a8d7a96f" />
