## 🚀 快速开始

1.  **解压压缩包**：**必须解压**，严禁在压缩包内直接运行。
2.  **文件检查**：确保文件夹内包含 `Bili_Final.exe` 以及 `config.json`、`BBdown.exe`、`ffmpeg.exe`（首次运行会自动生成或调用自带文件）。
3.  **启动**：双击 `Bili_Final.exe`，稍等片刻，浏览器将自动弹出控制台界面。

---

## 🔑 获取 SESSDATA (必读)

> ⚠️ **SESSDATA 是您的 B站“通行证”，不填或填错将无法获取任何数据。**

**获取步骤（Chrome/Edge 为例）：**
1.  在浏览器登录 Bilibili。
2.  按 **F12** 打开“开发者工具”。
3.  点击顶部菜单栏 **Application (应用)**（如未看到，点击右侧 `>>` 箭头）。
4.  左侧栏展开 **Cookies** -> 点击 `https://www.bilibili.com`。
5.  右侧列表找到 **SESSDATA**，复制 **Value (值)** 下方的那串长字符。
6.  回到软件侧边栏，粘贴至 **“账号凭证 (SESSDATA)”** 输入框，系统自动保存。

---

## 📦 功能模块

* **视频数据获取**：支持多行 UID 输入，自定义并发数。抓取结束后可导出含封面的 CSV，JSON 源文件保存在 `data` 文件夹。
* **封面提取**：输入 UID 扫描所有封面，支持预览、全选及**一键批量高清下载**。
* **任务日志**：侧边栏实时记录操作状态，方便回溯。
* **视频监测**：对单个视频实行自定义时间的流量数据监测，内置**哨兵删评监测机制**。
* **视频下载**：突破反爬，集成 **BBdown** 开源框架。支持不限速下载视频/弹幕/音频，支持三种编码，自动调用 **ffmpeg** 合成。

---

## 🌏 港澳台番剧下载模块 (HMT)

**功能概述**：集成 BBDown 核心、本地凭证注入及网络代理接管技术，解决 IP 检测、SSL 指纹识别及 API 鉴权问题。

### 前置条件 (缺一不可)
* **账号权限**：必须拥有 **Bilibili 年度大会员或普通大会员**资格。
* **网络环境**：必须拥有高质量的 **台湾或香港原生 IP 代理节点**（非机房 IP），并配置 HTTP 代理端口（如 `127.0.0.1:7890`）。
* **核心组件**：运行目录下必须包含 `BBDown.exe` 和 `ffmpeg.exe`。

### 操作流程

**步骤一：获取本地身份凭证**
1.  在脚本侧边栏找到 **账号凭证** 区域。
2.  点击 **扫码登录 (自动获取)** 按钮。
3.  控制台弹出二维码或链接后，使用手机 B 站 APP 扫码。
4.  登录成功后，根目录会自动生成 `BBDown.data` 文件并自动刷新。

**步骤二：配置下载参数 (推荐配置)**
进入 `视频下载` -> `直链/番剧下载` 标签页：
* **资源链接**：输入番剧的 `ss` ID 或 `ep` ID。
* **HTTP 代理地址**：**必填**，格式为 `http://IP:端口`。
* **接口模式**：推荐选择 **Web 接口 (推荐)**（风控阈值最低，通过率最高）。
* **画质/编码**：建议均设置为 **自动 (Auto)**（强制指定可能因源缺失导致失败）。
* **Aria2 加速**：**务必关闭**（多线程易触发防火墙 SSL 阻断，单线程最稳定）。
* **使用扫码凭证**：**勾选**（优先读取本地 `BBDown.data`）。

**步骤三：执行下载**
点击 **开始下载**，观察诊断框确认“身份”为“本地凭证”，“网络”为“代理已启用”。等待日志滚动，文件将保存至 `history/videos/Downloads_Direct`。

---

## 🛠️ 常见问题排查 (FAQ)

**Q1: 报错 `Arg_IndexOutOfRangeException`**
* **原因**：获取到的视频流列表为空（IP 判定非港澳台或账号无权限）。
* **解法**：检查大会员状态；更换**原生解锁节点**；画质/编码设为“自动”；切换为 **Web 接口**。

**Q2: 报错 `net_http_ssl_connection_failed`**
* **原因**：SSL 握手失败（防火墙识别非浏览器指纹或 Aria2 并发攻击判定）。
* **解法**：**取消勾选 Aria2 加速**；更换代理节点。

**Q3: 报错 `ERROR: {"code":-10403,"message":"购买后才能观看哦"}`**
* **原因**：鉴权成功但权限不足。
* **解法**：确认账号会员有效期；如是会员依然报错，说明当前接口策略被风控，尝试切换接口模式。

**Q4: 提示下载成功，但文件夹内没有视频文件**
* **原因**：下载过程被服务端阻断，只下载了不锁区的弹幕文件。
* **解法**：检查子目录；参考 Q2 关闭 Aria2。

**Q5: 界面报错 `NotFoundError: ... removeChild`**
* **原因**：后台日志刷新频率过高导致前端渲染崩溃。
* **解法**：不影响后台下载。最新版已加入日志限速，**重启终端**即可解决。

---

## 📝 开发更新日志

* **V37.0 (Stable) - 救砖稳健版**：重构接口策略，默认推荐 **Web 接口**；强制加载本地凭证 (`BBDown.data`)；默认关闭 Aria2 以解决 SSL 阻断，牺牲速度换取最高成功率。
* **V36.0 (已废弃)**：尝试强制 APP 接口，因高纯度 IP 要求导致大量报错。
* **V33.0**：引入 APP/TV/Web 三种接口切换策略；增加代理地址自动修复。
* **V31.0**：修复扫码成功但下载提示未登录问题，锁定工作目录路径。
* **V30.0系列**：集成二维码生成库实现界面扫码；增加日志清洗及 0KB 凭证文件校验。
* **V29.0**：首次引入 HTTP_PROXY 环境变量注入及 `-app` 参数，突破区域限制。
<img width="3840" height="1947" alt="42a23b25246a222777014d504ed54512" src="https://github.com/user-attachments/assets/7bb9d65f-20ed-42d7-9ef8-d5aeac66613b" />
<img width="3840" height="1944" alt="f1f29f0713ed103ebf270ff4ad7606c6" src="https://github.com/user-attachments/assets/77a43271-896a-4716-95a5-8f7dde1ba7b0" />
<img width="3840" height="1944" alt="bd62cf34bcc10683fc602f2a63655880" src="https://github.com/user-attachments/assets/294d59a2-6d7f-470c-9b62-8436a8d7a96f" />
